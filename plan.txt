
# PLAN DE DESARROLLO - SOCCER STATS APP

## ESTRUCTURA DEL PROYECTO
```
Soccer Stats App (React Native + Expo Router)
‚îú‚îÄ‚îÄ Autenticaci√≥n (JWT con cookies HttpOnly)
‚îú‚îÄ‚îÄ Estad√≠sticas de competiciones
‚îú‚îÄ‚îÄ Sistema de favoritos
‚îî‚îÄ‚îÄ Perfil de usuario
```

---

##  PHASE 1: AUTENTICACI√ìN Y PANTALLA STATS

### 1.1 IMPLEMENTAR SISTEMA DE AUTENTICACI√ìN

#### 1.1.1 Crear pantalla de Login
**Archivo:** `/app/login.js`
- **UI/UX:**
  - Fondo con gradiente oscuro (tema actual)
  - Campo de entrada para correo electr√≥nico
  - Campo de entrada para contrase√±a
  - Bot√≥n principal "Iniciar Sesi√≥n"
  - Enlace secundario "¬øNo tienes cuenta? Reg√≠strate"
- **Funcionalidad:**
  - Validaci√≥n de campos (correo v√°lido, contrase√±a no vac√≠a)
  - Llamada a `api/auth.js -> login()`
  - Manejo de errores (mostrar mensaje si credenciales incorrectas)
  - Redirecci√≥n autom√°tica a tabs despu√©s del login exitoso
- **Datos a enviar:**
  ```json
  {
    "correo": "alexis.tuz@email.com",
    "contrasena": "123"
  }
  ```

#### 1.1.2 Crear pantalla de Registro
**Archivo:** `/app/register.js`
- **UI/UX:**
  - Dise√±o consistente con login
  - Campo para nombre completo
  - Campo para correo electr√≥nico
  - Campo para contrase√±a
  - Bot√≥n principal "Registrarse"
  - Enlace "¬øYa tienes cuenta? Inicia sesi√≥n"
- **Funcionalidad:**
  - Validaci√≥n completa de formulario
  - Llamada a `api/auth.js -> registrar()`
  - Redirecci√≥n autom√°tica a login despu√©s del registro exitoso
  - Mostrar mensaje de confirmaci√≥n
- **Datos a enviar:**
  ```json
  {
    "nombre": "Alexis",
    "correo": "alexis.tuz@email.com",
    "contrasena": "123"
  }
  ```

###  **MANEJO DE AUTENTICACI√ìN CON COOKIES (ESENCIAL)**

** PUNTO CR√çTICO A ENTENDER:**

Cuando el usuario inicia sesi√≥n, el backend devuelve una cookie HttpOnly llamada `soccer-stats-token`. Esta es la **clave de toda la autenticaci√≥n** y funciona as√≠:

1. **Al hacer login exitoso:**
   - Backend retorna: `{ "id": ..., "nombre": ..., "correo": ..., "token": "..." }`
   - Backend setea autom√°ticamente la cookie `soccer-stats-token` (HttpOnly)
   - Frontend NO necesita hacer nada con el token retornado

2. **Para requests posteriores:**
   - La cookie se env√≠a autom√°ticamente en TODAS las requests
   - Backend detecta la cookie autom√°ticamente  
   - NO hay que poner headers `Authorization` ni manejar tokens
   - Backend usa `@jwt_required` que inyecta el `usuario_id` autom√°ticamente

3. **Al hacer logout:**
   - Llamar a `POST /usuarios/logout`
   - Backend borra la cookie autom√°ticamente
   - Usuario queda desautenticado

** REGLA DE ORO:** El frontend NUNCA maneja tokens manualmente. Todo es autom√°tico v√≠a cookies.

#### 1.1.3 Implementar l√≥gica de autenticaci√≥n en layout principal
**Archivo:** `/app/_layout.js`
- **Funcionalidad:**
  - Verificar estado de autenticaci√≥n al iniciar la app
  - Llamada a `api/auth.js -> getUsuarios()` para validar cookie
  - Redirecci√≥n condicional:
    - Si NO autenticado ‚Üí mostrar `/login`
    - Si autenticado ‚Üí mostrar tabs normalmente
- **Manejo de cookies (CR√çTICO):**
  -  **IMPORTANTE:** Cuando se inicia sesi√≥n, el backend devuelve una cookie HttpOnly
  - El frontend NO debe manejar nada de esa l√≥gica manualmente
  - La cookie `soccer-stats-token` se guarda autom√°ticamente en el navegador
  - Con esa cookie, al hacer cualquier otra request, el backend la detecta autom√°ticamente
  - **NO es necesario poner headers de autorizaci√≥n ni manejar tokens manualmente**
  - La cookie se env√≠a autom√°ticamente en todas las requests futuras
  - El backend usa el decorador `@jwt_required` que inyecta autom√°ticamente el `usuario_id`

#### 1.1.4 Actualizar perfil de usuario
**Archivo:** `/app/(tabs)/perfil.js`
- **Funcionalidad:**
  - Cargar datos del usuario con `getUsuarios()`
  - Mostrar informaci√≥n: nombre, correo, ID
  - Bot√≥n de "Cerrar Sesi√≥n"
  - Llamada a `logout()` y redirecci√≥n a login
- **Datos mostrados:**
  ```json
  {
    "correo": "alexis.tuz@email.com",
    "id": 3,
    "nombre": "Alexis"
  }
  ```

### 1.2 IMPLEMENTAR PANTALLA DE ESTAD√çSTICAS

#### 1.2.1 Actualizar API de competiciones
**Archivo:** `/api/competiciones.js`
- **Nuevos endpoints:**
  ```javascript
  // Obtener posiciones de una competici√≥n
  export async function getPosiciones(competicionId = 2021) {
    // GET: /competiciones/{competicionId}/posiciones
  }
  
  // Obtener goleadores de una competici√≥n
  export async function getGoleadores(competicionId = 2021) {
    // GET: /competiciones/{competicionId}/goleadores
  }
  ```

#### 1.2.2 Implementar secci√≥n de competiciones destacadas
**Archivo:** `/app/(tabs)/stats.js`
- **UI/UX:**
  - T√≠tulo "Competiciones Destacadas"
  - Secci√≥n "Top 5 Posiciones" con tabla ordenada
  - Secci√≥n "Top 5 Goleadores" con cards de jugadores
  - Loading states para cada secci√≥n
  - Refresh pull-to-refresh
- **Datos a mostrar:**
  - **Posiciones:** equipo, puntos, partidos jugados, diferencia goles
  - **Goleadores:** nombre, equipo, goles, assists (si disponible)

---

##  PHASE 2: SISTEMA DE FAVORITOS - VISUALIZACI√ìN

### 2.1 CREAR API DE FAVORITOS
**Archivo:** `/api/favoritos.js`
- **Endpoints a implementar:**
  ```javascript
  // Obtener competiciones favoritas
  export async function getCompeticionesFavoritas() {
    // GET: /competiciones-favoritas
  }
  
  // Obtener equipos favoritos
  export async function getEquiposFavoritos() {
    // GET: /equipos-favoritos  
  }
  
  // Obtener jugadores favoritos
  export async function getFavoritosPersonas() {
    // GET: /favoritos-personas
  }
  ```

### 2.2 IMPLEMENTAR PANTALLA DE FAVORITOS
**Archivo:** `/app/(tabs)/favoritos.js`
- **UI/UX:**
  - Tres secciones con scroll horizontal:
    1. "Mis Competiciones" usando `CompetitionCard`
    2. "Mis Equipos" usando `TeamCard`
    3. "Mis Jugadores" usando `PlayerCard`
  - Estado vac√≠o cuando no hay favoritos
  - Loading states independientes
  - Pull-to-refresh global
- **Funcionalidad:**
  - Cargar datos de cada endpoint al montar
  - Manejar estados de carga y error
  - Refresh autom√°tico al volver al tab

### 2.3 VERIFICAR Y AJUSTAR COMPONENTES
**Archivos:** `/components/PlayerCard.jsx`, `/components/TeamCard.jsx`, `/components/CompetitionCard.jsx`
- **Verificaciones necesarias:**
  - Prop `favorited` est√° siendo usada correctamente
  - Callback `onToggleFavorite` est√° definido
  - Dise√±o es consistente entre componentes
  - Manejo de datos faltantes o malformados

---

##  PHASE 3: SISTEMA DE FAVORITOS - INTERACTIVIDAD

### 3.1 EXTENDER API DE FAVORITOS
**Archivo:** `/api/favoritos.js`
- **Nuevos endpoints para acciones:**
  ```javascript
  // Agregar/quitar competici√≥n de favoritos
  export async function toggleCompeticionFavorita(competicionId) {
    // POST/DELETE: /competiciones-favoritas
  }
  
  // Agregar/quitar equipo de favoritos  
  export async function toggleEquipoFavorito(equipoId) {
    // POST/DELETE: /equipos-favoritos
  }
  
  // Agregar/quitar jugador de favoritos
  export async function togglePersonaFavorita(personaId) {
    // POST/DELETE: /favoritos-personas
  }
  ```

### 3.2 IMPLEMENTAR L√ìGICA DE FAVORITOS EN COMPONENTES

#### 3.2.1 PlayerCard
**Archivo:** `/components/PlayerCard.jsx`
- **Funcionalidad:**
  - Detectar si el jugador es favorito
  - Cambiar √≠cono: ‚ù§Ô∏è (favorito) / ü§ç (no favorito)
  - Llamada a API al hacer clic
  - Actualizar estado local inmediatamente
  - Manejar errores de red

#### 3.2.2 TeamCard  
**Archivo:** `/components/TeamCard.jsx`
- **Funcionalidad similar a PlayerCard**
- **Consideraciones:**
  - Mostrar escudo del equipo
  - Informaci√≥n adicional (liga, pa√≠s)

#### 3.2.3 CompetitionCard
**Archivo:** `/components/CompetitionCard.jsx`
- **Funcionalidad similar a PlayerCard**
- **Consideraciones:**
  - Mostrar logo de la competici√≥n
  - Informaci√≥n adicional (temporada, pa√≠s)

### 3.3 INTEGRAR FAVORITOS EN OTRAS PANTALLAS

#### 3.3.1 Pantalla de Equipos
**Archivo:** `/app/equipos.js`
- Agregar funcionalidad de favoritos a cada TeamCard
- Estado global de favoritos

#### 3.3.2 Pantalla de Competiciones  
**Archivo:** `/app/competiciones.js`
- Agregar funcionalidad de favoritos a cada CompetitionCard
- Estado global de favoritos

---

##  PHASE 4: MEJORAS Y PULIMIENTO

### 4.1 MANEJO DE ESTADOS GLOBALES
- **Contexto de Autenticaci√≥n:**
  - Estado global del usuario
  - Funciones de login/logout
  - Persistencia de sesi√≥n
- **Contexto de Favoritos:**
  - Lista global de favoritos por tipo
  - Funciones para agregar/quitar
  - Sincronizaci√≥n con API

### 4.2 OPTIMIZACIONES
- **Performance:**
  - Memoizaci√≥n de componentes
  - Lazy loading de im√°genes
  - Debounce en b√∫squedas
- **UX:**
  - Animaciones de transici√≥n
  - Feedback haptic en favoritos
  - Skeleton loading states

### 4.3 MANEJO DE ERRORES
- **Conectividad:**
  - Detecci√≥n de conexi√≥n
  - Modo offline b√°sico
  - Retry autom√°tico
- **Errores de API:**
  - Mensajes de error amigables
  - Fallbacks para datos faltantes

---

## üìã CRITERIOS DE COMPLETITUD

### Phase 1  Criterios:
- [ ] Usuario puede registrarse con nombre, correo, contrase√±a
- [ ] Usuario puede iniciar sesi√≥n con correo y contrase√±a  
- [ ] Redirecci√≥n autom√°tica seg√∫n estado de autenticaci√≥n
- [ ] Pantalla de perfil muestra datos del usuario
- [ ] Funcionalidad de logout funciona correctamente
- [ ] Pantalla stats muestra top 5 posiciones y goleadores

### Phase 2  Criterios:
- [ ] Pantalla favoritos carga competiciones favoritas
- [ ] Pantalla favoritos carga equipos favoritos
- [ ] Pantalla favoritos carga jugadores favoritos
- [ ] Todas las cards se renderizan correctamente
- [ ] Estados de carga y error funcionan

### Phase 3 Criterios:
- [ ] Bot√≥n de favoritos funciona en PlayerCard
- [ ] Bot√≥n de favoritos funciona en TeamCard  
- [ ] Bot√≥n de favoritos funciona en CompetitionCard
- [ ] Estado favorito/no favorito se refleja visualmente
- [ ] Cambios se sincronizan con el backend
- [ ] Favoritos se actualizan en tiempo real

---

## üîß CONFIGURACI√ìN T√âCNICA

### Dependencias actuales:
- **React Native + Expo Router:** Navegaci√≥n y estructura
- **NativeWind:** Styling con Tailwind CSS
- **React Native SVG:** Iconograf√≠a y gr√°ficos

### APIs Backend esperadas:
```
BASE_URL = "tu-backend-url"

Autenticaci√≥n:
POST /usuarios/registrar
POST /usuarios/login  
POST /usuarios/logout
GET  /usuarios

Competiciones:
GET  /competiciones/{id}/posiciones
GET  /competiciones/{id}/goleadores

Favoritos:
GET    /competiciones-favoritas
POST   /competiciones-favoritas  
DELETE /competiciones-favoritas/{id}
GET    /equipos-favoritos
POST   /equipos-favoritos
DELETE /equipos-favoritos/{id}
GET    /favoritos-personas  
POST   /favoritos-personas
DELETE /favoritos-personas/{id}
``` 



